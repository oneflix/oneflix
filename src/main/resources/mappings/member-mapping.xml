<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MemberDAO">
   <insert id="insertMember" parameterType="member">
      INSERT INTO member(email, pass, nick, birth, member_age, gender, cert, ban, join_date, ticket_id, google, kakao, naver)
      VALUES(#{email}, #{pass}, #{nick}, #{birth}, #{memberAge}, #{gender}, #{cert}, #{ban}, SYSDATE, 0, 
      #{google, jdbcType=VARCHAR}, #{kakao, jdbcType=VARCHAR}, #{naver, jdbcType=VARCHAR})
   </insert>

  <update id="updateMember" parameterType="member">
      UPDATE member SET pass = #{pass}, nick = #{nick}, ban = #{ban, jdbcType=CHAR}, #{google, jdbcType=VARCHAR}, #{kakao, jdbcType=VARCHAR}, #{naver, jdbcType=VARCHAR})
      WHERE email = #{email}
   </update>
  
   <delete id="deleteMember" parameterType="member">
      DELETE FROM member WHERE email = #{email}
   </delete>
   
    <select id="getMember" resultType="member" parameterType="member">
      SELECT * FROM member
      WHERE 1=1
      <choose>
         <when test="kakao != null and kakao != ''">
            AND kakao = #{kakao}
         </when>
         <when test="naver != null and naver != ''">
            AND naver = #{naver}
         </when>
         <when test="google != null and google != ''">
            AND google = #{google}
         </when>
         <otherwise>
            AND email = #{email}
         </otherwise>
      </choose>
   </select>
   
   <resultMap type="member" id="memberList">
		<id property="email" column="email" />
		<result property="pass" column="pass" />
		<result property="nick" column="nick" />
		<result property="birth" column="birth" />
		<result property="memberAge" column="member_age" />
		<result property="gender" column="gender" />
		<result property="cert" column="cert" />
	</resultMap>
  

   <select id="getMemberList" resultMap="memberList" parameterType="member">
      SELECT * FROM member WHERE 1=1
		<if test="searchMember != null and searchMember =''">
			AND (email like '%' || #{searchMember} || '%'
			OR nick like '%' || #{searchMember} || '%')
		</if> 
		<if test="searchTicket != null and searchTicket != '-9'">
			AND ticket_id = #{searchTicket}
		</if> 
		<if test="searchCert != null and searchCert != 'all'">
			AND cert = #{searchCert}
		</if> 
		<if test="searchBan != null and searchBan != 'all'">
			AND ban = #{searchBan}
		</if> 
      ORDER BY join_date DESC
   </select>
	
</mapper>
